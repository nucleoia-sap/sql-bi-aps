<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanseníase - BI Prefeitura</title>
    <link rel="shortcut icon" href="../assets/logos/logo-prefeitura-3.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

    <link rel="stylesheet" href="../styles/global.css">
</head>

<body class="bg-slate-50 text-slate-800 h-screen flex overflow-hidden">

    <!-- Mobile Header -->
    <div class="fixed w-full bg-slate-900 text-white z-50 flex items-center justify-between p-4 md:hidden">
        <div class="font-bold text-lg flex items-center gap-2">
            <i class="ph ph-bank text-sky-400"></i> BI-APS
        </div>
        <button onclick="toggleSidebar()" class="text-white focus:outline-none">
            <i class="ph ph-list text-2xl"></i>
        </button>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="bg-slate-900 text-slate-300 w-64 flex-shrink-0 fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out z-40 flex flex-col h-full shadow-xl">

        <!-- Header Sidebar -->
        <div
            class="p-6 pt-24 md:pt-8 border-b border-slate-800 flex flex-col items-center justify-center text-center gap-2">
            <div class="w-40 h-auto flex items-center justify-center mb-2">
                <img src="../assets/logos/logo-prefeitura-2.png" alt="Logo Prefeitura"
                    class="w-full h-auto object-contain">
            </div>
            <div class="flex flex-col gap-1 w-full mt-5">
                <h1 class="font-bold text-white text-xl tracking-wide">BI-APS</h1>
                <p
                    class="text-[10px] text-slate-500 uppercase tracking-[0.2em] font-medium border-t border-slate-800 pt-2 mt-1">
                    Documentação</p>
            </div>
        </div>

        <!-- Busca -->
        <div class="p-4">
            <div class="relative">
                <i class="ph ph-magnifying-glass absolute left-3 top-2.5 text-slate-500"></i>
                <input id="sidebar-search" type="text" placeholder="Buscar query..."
                    class="w-full bg-slate-800 text-sm text-slate-200 rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-1 focus:ring-sky-500 border border-slate-700 placeholder-slate-500 transition-all focus:border-sky-500/50">
            </div>
        </div>

        <!-- Menu de Navegação -->
        <nav class="flex-1 overflow-y-auto py-2 space-y-6 px-3 custom-scrollbar">

            <!-- Link Visão Geral -->
            <div>
                <a href="./index.html"
                    class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium">
                    <i class="ph ph-house"></i> Visão Geral
                </a>
            </div>

            <!-- Grupo: BI APS -->
            <div>
                <h3 class="px-3 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">BI APS (Atenção
                    Primária)</h3>
                <ul class="space-y-1">

                    <!-- 1. Query - QUEM SOMOS -->
                    <li>
                        <a href="./bi_aps_quem_somos.html"
                            class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 transition-colors">
                            <i class="ph ph-identification-card"></i> Query - QUEM SOMOS
                        </a>
                    </li>

                    <!-- 2. Dropdown Pai: A QUEM SERVIMOS -->
                    <li>
                        <button onclick="toggleSubmenu('submenu-servimos', 'chevron-servimos')"
                            class="active sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors">
                            <div class="flex items-center gap-3">
                                <i class="ph ph-users-three"></i>
                                A QUEM SERVIMOS
                            </div>
                            <i id="chevron-servimos"
                                class="ph ph-caret-down text-slate-500 transition-transform duration-200 rotate-180"></i>
                        </button>

                        <!-- Container do Submenu Servimos -->
                        <div id="submenu-servimos"
                            class="pl-7 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">

                            <!-- Link Simples dentro do Servimos -->
                            <a href="./bi_aps_a_quem_servimos.html"
                                class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                Query - A QUEM SERVIMOS
                            </a>

                            <!-- NOVO: Dropdown Aninhado (Perfil clínico-epidemiológico) -->
                            <div class="mt-1">
                                <button onclick="toggleSubmenu('submenu-perfil', 'chevron-perfil')"
                                    class="sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors overflow-hidden">
                                    <div class="flex items-center gap-3 overflow-hidden w-full">
                                        <i class="ph ph-chart-bar flex-shrink-0"></i>
                                        <div class="marquee-container">
                                            <span class="marquee-text">Perfil clínico-epidemiológico</span>
                                        </div>
                                    </div>
                                    <i id="chevron-perfil"
                                        class="ph ph-caret-down text-slate-500 transition-transform duration-200"></i>
                                </button>

                                <!-- Submenu do Perfil (Hanseníase, TB, etc) -->
                                <div id="submenu-perfil"
                                    class="pl-8 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">
                                    <a href="./bi_aps_hanseniase.html"
                                        class="submenu-link block py-2 text-sm text-sky-400 font-medium hover:text-sky-300 transition-colors">
                                        Query - Hanseníase
                                    </a>
                                    <a href="./emConstrucao.html"
                                        class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                        Query - Turbeculose
                                    </a>
                                    <a href="./emConstrucao.html"
                                        class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                        Query - Sífilis
                                    </a>
                                    <a href="./emConstrucao.html"
                                        class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                        Query - Hepatites
                                    </a>
                                </div>
                            </div>
                        </div>
                    </li>

                    <!-- 3. Dropdown Pai: Nossos Resultados (NOVO) -->
                    <li>
                        <button onclick="toggleSubmenu('submenu-resultados', 'chevron-resultados')"
                            class="sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors">
                            <div class="flex items-center gap-3">
                                <i class="ph ph-chart-line-up"></i>
                                Nossos resultados
                            </div>
                            <i id="chevron-resultados"
                                class="ph ph-caret-down text-slate-500 transition-transform duration-200"></i>
                        </button>

                        <!-- Container do Submenu Resultados -->
                        <div id="submenu-resultados"
                            class="hidden pl-7 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">

                            <!-- Link: SIAPS -->
                            <a href="./bi_aps_siaps.html"
                                class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                Query - Sistemas de Informação (SIAPS)
                            </a>

                            <!-- Link: UAPI -->
                            <a href="./emConstrucao.html"
                                class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                Query - Unidade Amiga da primeira infância (UAPI)
                            </a>

                            <!-- Link: Accountability -->
                            <a href="./emConstrucao.html"
                                class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                Query - Accountability
                            </a>

                            <!-- Subpasta: Doenças Crônicas Transmissíveis -->
                            <div class="mt-1">
                                <button onclick="toggleSubmenu('submenu-dct', 'chevron-dct')"
                                    class="sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors overflow-hidden">
                                    <div class="flex items-center gap-3 overflow-hidden w-full">
                                        <i class="ph ph-virus flex-shrink-0"></i>
                                        <div class="marquee-container">
                                            <span class="marquee-text">Doenças Crônicas Transmissíveis</span>
                                        </div>
                                    </div>
                                    <i id="chevron-dct"
                                        class="ph ph-caret-down text-slate-500 transition-transform duration-200"></i>
                                </button>
                                <div id="submenu-dct"
                                    class="hidden pl-8 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">
                                    <a href="./emConstrucao.html"
                                        class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                        Query - Exemplo
                                    </a>
                                </div>
                            </div>

                            <!-- Subpasta: Doenças crônicas não transmissíveis -->
                            <div class="mt-1">
                                <button onclick="toggleSubmenu('submenu-dcnt', 'chevron-dcnt')"
                                    class="sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors overflow-hidden">
                                    <div class="flex items-center gap-3 overflow-hidden w-full">
                                        <i class="ph ph-heart-beat flex-shrink-0"></i>
                                        <div class="marquee-container">
                                            <span class="marquee-text">Doenças Crônicas Não Transmissíveis</span>
                                        </div>
                                    </div>
                                    <i id="chevron-dcnt"
                                        class="ph ph-caret-down text-slate-500 transition-transform duration-200"></i>
                                </button>
                                <div id="submenu-dcnt"
                                    class="hidden pl-8 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">
                                    <a href="./emConstrucao.html"
                                        class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                        Query - Exemplo
                                    </a>
                                </div>
                            </div>

                            <!-- Subpasta: Ciclo de vidas -->
                            <div class="mt-1">
                                <button onclick="toggleSubmenu('submenu-ciclo', 'chevron-ciclo')"
                                    class="sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors overflow-hidden">
                                    <div class="flex items-center gap-3 overflow-hidden w-full">
                                        <i class="ph ph-arrows-clockwise flex-shrink-0"></i>
                                        <div class="marquee-container">
                                            <span class="marquee-text">Ciclo de Vidas</span>
                                        </div>
                                    </div>
                                    <i id="chevron-ciclo"
                                        class="ph ph-caret-down text-slate-500 transition-transform duration-200"></i>
                                </button>
                                <div id="submenu-ciclo"
                                    class="hidden pl-8 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">
                                    <a href="./emConstrucao.html"
                                        class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                        Query - Exemplo
                                    </a>
                                </div>
                            </div>

                        </div>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Footer Sidebar -->
        <div class="p-4 border-t border-slate-800 text-xs text-slate-500 text-center" id="versao-sistema">
        </div>
    </aside>

    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"></div>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full overflow-hidden relative w-full bg-slate-50">
        <div class="flex-1 overflow-y-auto p-6 md:p-10 pt-20 md:pt-10">
            <div class="max-w-6xl mx-auto">

                <!-- Cabeçalho da Query -->
                <div
                    class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8 pb-6 border-b border-slate-200">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span
                                class="bg-amber-100 text-amber-700 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide">Agravo
                                Específico</span>
                            <span class="text-slate-400 text-sm">/</span>
                            <span class="text-slate-500 text-sm">Linha de Cuidado</span>
                        </div>
                        <h1 class="text-3xl font-bold text-slate-900">QUERY - HANSENÍASE</h1>
                        <p class="text-slate-600 mt-1">Identificação de pacientes em tratamento ativo via critérios
                            clínicos,
                            medicamentosos e administrativos.</p>
                    </div>
                    <div class="flex gap-3">
                        <a href="#"
                            class="flex items-center gap-2 bg-sky-600 text-white hover:bg-sky-700 px-4 py-2 rounded-md text-sm font-medium transition-colors shadow-sm">
                            <i class="ph ph-arrow-square-out"></i> Abrir no BigQuery
                        </a>
                    </div>
                </div>

                <!-- Resumo / Metadados -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                        <p class="text-xs text-slate-500 uppercase font-semibold mb-1">Tabela Final</p>
                        <p class="text-slate-800 font-medium text-xs break-all font-mono bg-slate-50 p-1 rounded">
                            rj-sms-sandbox.sub_pav_us._hanseniase_em_tratamento
                        </p>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                        <p class="text-xs text-slate-500 uppercase font-semibold mb-1">Fontes Principais</p>
                        <div class="text-slate-800 font-medium text-sm flex flex-col gap-1">
                            <span class="flex items-center gap-1"><i class="ph ph-pill"></i> Prescrições
                                (Medicamentos)</span>
                            <span class="flex items-center gap-1"><i class="ph ph-file-text"></i> Vitacare (Lista
                                Oficial)</span>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                        <p class="text-xs text-slate-500 uppercase font-semibold mb-1">Janela Temporal</p>
                        <p class="text-slate-800 font-medium flex items-center gap-2">
                            <i class="ph ph-calendar text-amber-500"></i> Últimos 18 Meses
                        </p>
                    </div>
                </div>

                <!-- Sistema de Abas -->
                <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden mb-10">
                    <div class="border-b border-slate-200 flex overflow-x-auto bg-slate-50">
                        <button onclick="openTab('regras')" id="btn-regras"
                            class="tab-btn active px-6 py-4 text-sm font-medium text-slate-500 hover:text-slate-700 focus:outline-none">Regras
                            de Negócio</button>
                        <button onclick="openTab('sql')" id="btn-sql"
                            class="tab-btn px-6 py-4 text-sm font-medium text-slate-500 hover:text-slate-700 focus:outline-none">Script
                            SQL</button>
                        <button onclick="openTab('dicionario')" id="btn-dicionario"
                            class="tab-btn px-6 py-4 text-sm font-medium text-slate-500 hover:text-slate-700 focus:outline-none">Dicionário
                            de Dados</button>
                    </div>

                    <!-- Conteúdo: Regras de Negócio -->
                    <div id="regras" class="tab-content active p-8">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Critérios de Inclusão (Multicritério)</h3>
                        <p class="text-slate-600 text-sm mb-6">
                            Para maximizar a sensibilidade da detecção, um paciente é considerado "Em Tratamento" se
                            atender a
                            <strong>pelo menos um</strong> dos critérios abaixo na janela dos últimos 18 meses.
                        </p>
                        <ul class="space-y-6">
                            <li class="flex gap-3">
                                <div class="flex-shrink-0 mt-1">
                                    <span
                                        class="flex items-center justify-center w-6 h-6 rounded-full bg-purple-100 text-purple-600 font-bold text-xs">1</span>
                                </div>
                                <div>
                                    <strong class="text-slate-900 block">Critério Farmacológico (Prescrições)</strong>
                                    <p class="text-slate-600 text-sm mt-1">
                                        Identificação de medicamentos rastreadores específicos (poliquimioterapia).
                                        <br><span
                                            class="text-xs bg-slate-100 px-1 py-0.5 rounded text-slate-500 font-mono mt-1 inline-block">Rifampicina
                                            + Clofazimina + Dapsona</span> ou combinações com Ofloxacino/Minociclina.
                                    </p>
                                </div>
                            </li>
                            <li class="flex gap-3">
                                <div class="flex-shrink-0 mt-1">
                                    <span
                                        class="flex items-center justify-center w-6 h-6 rounded-full bg-purple-100 text-purple-600 font-bold text-xs">2</span>
                                </div>
                                <div>
                                    <strong class="text-slate-900 block">Critério Clínico (CID Ativo)</strong>
                                    <p class="text-slate-600 text-sm mt-1">
                                        Registro de Episódio Assistencial com diagnóstico CID iniciando em
                                        <strong>A30</strong> (Hanseníase)
                                        e situação marcada como 'ATIVO' em qualquer momento da janela temporal.
                                    </p>
                                </div>
                            </li>
                            <li class="flex gap-3">
                                <div class="flex-shrink-0 mt-1">
                                    <span
                                        class="flex items-center justify-center w-6 h-6 rounded-full bg-purple-100 text-purple-600 font-bold text-xs">3</span>
                                </div>
                                <div>
                                    <strong class="text-slate-900 block">Critério Administrativo (Lista
                                        Oficial)</strong>
                                    <p class="text-slate-600 text-sm mt-1">
                                        Presença na lista oficial de notificação (SINAN/Vitacare). Como essa lista as
                                        vezes não possui CPF,
                                        é feito um cruzamento (JOIN) com a tabela <code>acto</code> para recuperar o CPF
                                        do paciente via
                                        chave composta (CNES + Prontuário).
                                    </p>
                                </div>
                            </li>
                            <li class="flex gap-3">
                                <div class="flex-shrink-0 mt-1">
                                    <i class="ph ph-funnel text-slate-400 text-xl"></i>
                                </div>
                                <div>
                                    <strong class="text-slate-900 block">Filtro de Escopo (APS)</strong>
                                    <p class="text-slate-600 text-sm mt-1">
                                        A lista final é filtrada para conter apenas unidades classificadas como
                                        <strong>Atenção Primária à
                                            Saúde (APS)</strong> na tabela mestre de estabelecimentos.
                                    </p>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- Conteúdo: SQL -->
                    <div id="sql" class="tab-content p-0">
                        <div class="relative">

                            <button onclick="copyElementId('code-hanseniase', this)"
                                class="absolute top-4 right-4 bg-slate-700 hover:bg-slate-600 text-white text-xs px-3 py-1.5 rounded flex items-center gap-2 transition-colors z-10">
                                <i class="ph ph-copy"></i> Copiar
                            </button>

                            <div id="block-hanseniase" class="code-block">
                                <pre
                                    class="m-0"><code id="code-hanseniase" class="language-sql shadow-none rounded-none">Carregando query...</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Conteúdo: Dicionário -->
                    <div id="dicionario" class="tab-content">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm text-slate-600">
                                <thead class="bg-slate-50 text-slate-500 font-medium border-b border-slate-200">
                                    <tr>
                                        <th class="px-6 py-3 border-r border-slate-200 w-1/4">Coluna</th>
                                        <th class="px-6 py-3 border-r border-slate-200 w-1/6">Tipo</th>
                                        <th class="px-6 py-3">Descrição</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100">
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-pink-600 bg-pink-50/30">cpf</td>
                                        <td class="px-6 py-3 text-xs">STRING</td>
                                        <td class="px-6 py-3">CPF do paciente (apenas dígitos).</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-blue-600 bg-blue-50/30">
                                            criterio1_prescricao</td>
                                        <td class="px-6 py-3 text-xs">INTEGER (0/1)</td>
                                        <td class="px-6 py-3">Indica se o paciente recebeu prescrição de
                                            Rifampicina/Clofazimina/Dapsona.
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-blue-600 bg-blue-50/30">
                                            criterio2_cid_ativo</td>
                                        <td class="px-6 py-3 text-xs">INTEGER (0/1)</td>
                                        <td class="px-6 py-3">Indica se houve registro de CID A30* com situação 'ATIVO'.
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-blue-600 bg-blue-50/30">
                                            criterio3_lista_hanseniase</td>
                                        <td class="px-6 py-3 text-xs">INTEGER (0/1)</td>
                                        <td class="px-6 py-3">Indica presença na lista nominal oficial (Vitacare/SINAN).
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-emerald-600 bg-emerald-50/30">
                                            soma_criterios</td>
                                        <td class="px-6 py-3 text-xs">INTEGER</td>
                                        <td class="px-6 py-3">Soma dos flags acima. Indica a força da evidência (1 a 3).
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-purple-600 bg-purple-50/30">
                                            medicamentos_prescritos...
                                        </td>
                                        <td class="px-6 py-3 text-xs">STRING</td>
                                        <td class="px-6 py-3">Lista concatenada dos medicamentos identificados na
                                            prescrição mais recente.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
    <script src="../scripts/global.js"></script>
    <script src="../scripts/bi_aps_haseniase.js"></script>
</body>

</html>