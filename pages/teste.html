<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIAPS - BI APS</title>
    <link rel="shortcut icon" href="../assets/logos/logo-prefeitura-3.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Highlight.js para sintaxe SQL -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <!-- CSS Global (assumindo caminho relativo padrão) -->
    <link rel="stylesheet" href="../styles/global.css">

    <!-- Estilos Inline (Pode mover para ../styles/bi_aps_siaps.css se preferir) -->
    <style>
        .sql-selector-wrapper {
            position: relative;
            margin-bottom: 1rem;
        }

        .sql-select {
            appearance: none;
            background-color: #1e293b;
            /* slate-800 */
            color: #e2e8f0;
            /* slate-200 */
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid #334155;
            /* slate-700 */
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
        }

        .sql-select:hover {
            border-color: #38bdf8;
            /* sky-400 */
        }

        .sql-select:focus {
            ring: 2px solid #38bdf8;
            border-color: #38bdf8;
        }

        .select-arrow {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #94a3b8;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 h-screen flex overflow-hidden">

    <!-- Mobile Header -->
    <div class="fixed w-full bg-slate-900 text-white z-50 flex items-center justify-between p-4 md:hidden">
        <div class="font-bold text-lg flex items-center gap-2">
            <i class="ph ph-bank text-sky-400"></i> BI-APS
        </div>
        <button onclick="toggleSidebar()" class="text-white focus:outline-none">
            <i class="ph ph-list text-2xl"></i>
        </button>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="bg-slate-900 text-slate-300 w-64 flex-shrink-0 fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out z-40 flex flex-col h-full shadow-xl">

        <!-- Header Sidebar -->
        <div
            class="p-6 pt-24 md:pt-8 border-b border-slate-800 flex flex-col items-center justify-center text-center gap-2">
            <div class="w-40 h-auto flex items-center justify-center mb-2">
                <img src="../assets/logos/logo-prefeitura-2.png" alt="Logo Prefeitura"
                    class="w-full h-auto object-contain">
            </div>
            <div class="flex flex-col gap-1 w-full mt-5">
                <h1 class="font-bold text-white text-xl tracking-wide">BI-APS</h1>
                <p
                    class="text-[10px] text-slate-500 uppercase tracking-[0.2em] font-medium border-t border-slate-800 pt-2 mt-1">
                    Documentação</p>
            </div>
        </div>

        <!-- Busca -->
        <div class="p-4">
            <div class="relative">
                <i class="ph ph-magnifying-glass absolute left-3 top-2.5 text-slate-500"></i>
                <input id="sidebar-search" type="text" placeholder="Buscar query..."
                    class="w-full bg-slate-800 text-sm text-slate-200 rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-1 focus:ring-sky-500 border border-slate-700 placeholder-slate-500 transition-all focus:border-sky-500/50">
            </div>
        </div>

        <!-- Menu de Navegação -->
        <nav class="flex-1 overflow-y-auto py-2 space-y-6 px-3 custom-scrollbar">

            <!-- Link Visão Geral -->
            <div>
                <a href="../index.html"
                    class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium">
                    <i class="ph ph-house"></i> Visão Geral
                </a>
            </div>

            <!-- Grupo: BI APS -->
            <div>
                <h3 class="px-3 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">BI APS (Atenção
                    Primária)</h3>
                <ul class="space-y-1">

                    <!-- 1. Query - QUEM SOMOS -->
                    <li>
                        <a href="./bi_aps_quem_somos.html"
                            class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 transition-colors">
                            <i class="ph ph-identification-card"></i> Query - QUEM SOMOS
                        </a>
                    </li>

                    <!-- 2. Dropdown Pai: A QUEM SERVIMOS -->
                    <li>
                        <button onclick="toggleSubmenu('submenu-servimos', 'chevron-servimos')"
                            class="sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors">
                            <div class="flex items-center gap-3">
                                <i class="ph ph-users-three"></i>
                                A QUEM SERVIMOS
                            </div>
                            <i id="chevron-servimos"
                                class="ph ph-caret-down text-slate-500 transition-transform duration-200 rotate-180"></i>
                        </button>

                        <div id="submenu-servimos"
                            class="hidden pl-7 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">
                            <a href="./bi_aps_a_quem_servimos.html"
                                class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                Query - A QUEM SERVIMOS
                            </a>
                            <!-- Submenu Perfil (oculto por padrão neste contexto) -->
                            <div class="mt-1">
                                <button onclick="toggleSubmenu('submenu-perfil', 'chevron-perfil')"
                                    class="sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors overflow-hidden">
                                    <div class="flex items-center gap-3 overflow-hidden w-full">
                                        <i class="ph ph-chart-bar flex-shrink-0"></i>
                                        <div class="marquee-container">
                                            <span class="marquee-text">Perfil clínico-epidemiológico</span>
                                        </div>
                                    </div>
                                    <i id="chevron-perfil"
                                        class="ph ph-caret-down text-slate-500 transition-transform duration-200"></i>
                                </button>
                                <div id="submenu-perfil"
                                    class="hidden pl-8 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">
                                    <a href="./bi_aps_hanseniase.html"
                                        class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                        Query - Hanseníase
                                    </a>
                                    <!-- Outros links... -->
                                </div>
                            </div>
                        </div>
                    </li>

                    <!-- 3. Dropdown Pai: Nossos Resultados (ATIVO) -->
                    <li>
                        <button onclick="toggleSubmenu('submenu-resultados', 'chevron-resultados')"
                            class="active sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors">
                            <div class="flex items-center gap-3">
                                <i class="ph ph-chart-line-up"></i>
                                Nossos resultados
                            </div>
                            <i id="chevron-resultados"
                                class="ph ph-caret-down text-slate-500 transition-transform duration-200 rotate-180"></i>
                        </button>

                        <!-- Container do Submenu Resultados -->
                        <div id="submenu-resultados"
                            class="pl-7 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">

                            <!-- Link: SIAPS (ATIVO) -->
                            <a href="./bi_aps_siaps.html"
                                class="submenu-link block py-2 text-sm text-sky-400 font-medium hover:text-sky-300 transition-colors">
                                Query - Sistemas de Informação (SIAPS)
                            </a>

                            <!-- Outros Links -->
                            <a href="./emConstrucao.html"
                                class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                Query - Unidade Amiga da primeira infância (UAPI)
                            </a>
                            <a href="./emConstrucao.html"
                                class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                Query - Accountability
                            </a>

                            <!-- Subpastas ocultas (DCT, DCNT, Ciclo) -->
                            <div class="mt-1">
                                <button onclick="toggleSubmenu('submenu-dct', 'chevron-dct')"
                                    class="sidebar-link w-full flex items-center justify-between px-3 py-2 rounded-md text-sm text-slate-400 hover:text-white hover:bg-slate-800/50 group text-left focus:outline-none transition-colors overflow-hidden">
                                    <div class="flex items-center gap-3 overflow-hidden w-full">
                                        <i class="ph ph-virus flex-shrink-0"></i>
                                        <div class="marquee-container">
                                            <span class="marquee-text">Doenças Crônicas Transmissíveis</span>
                                        </div>
                                    </div>
                                    <i id="chevron-dct"
                                        class="ph ph-caret-down text-slate-500 transition-transform duration-200"></i>
                                </button>
                                <div id="submenu-dct"
                                    class="hidden pl-8 pr-2 py-1 space-y-1 overflow-hidden transition-all duration-300">
                                    <a href="./emConstrucao.html"
                                        class="submenu-link block py-2 text-sm text-slate-400 hover:text-sky-400 transition-colors">
                                        Query - Exemplo
                                    </a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Footer Sidebar -->
        <div class="p-4 border-t border-slate-800 text-xs text-slate-500 text-center" id="versao-sistema">
        </div>
    </aside>

    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"></div>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full overflow-hidden relative w-full bg-slate-50">
        <div class="flex-1 overflow-y-auto p-6 md:p-10 pt-20 md:pt-10">
            <div class="max-w-6xl mx-auto">

                <!-- Cabeçalho da Query -->
                <div
                    class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8 pb-6 border-b border-slate-200">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span
                                class="bg-blue-100 text-blue-700 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide">Indicadores
                                de Desempenho</span>
                            <span class="text-slate-400 text-sm">/</span>
                            <span class="text-slate-500 text-sm">Nossos Resultados</span>
                        </div>
                        <h1 class="text-3xl font-bold text-slate-900">QUERY - SIAPS</h1>
                        <p class="text-slate-600 mt-1">Consolidação dos indicadores do Sistema de Informação da Atenção
                            Primária à Saúde.</p>
                    </div>
                    <div class="flex gap-3">
                        <a href="#"
                            class="flex items-center gap-2 bg-sky-600 text-white hover:bg-sky-700 px-4 py-2 rounded-md text-sm font-medium transition-colors shadow-sm">
                            <i class="ph ph-arrow-square-out"></i> Abrir no BigQuery
                        </a>
                    </div>
                </div>

                <!-- Resumo / Metadados -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div
                        class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm relative overflow-hidden group">
                        <p class="text-xs text-slate-500 uppercase font-semibold mb-1">Tabela Final</p>
                        <!-- ID 'tableNameDisplay' e classes de transição -->
                        <div class="relative">
                            <p id="tableNameDisplay"
                                class="text-slate-800 font-medium text-xs break-all font-mono bg-slate-50 p-1 rounded transition-opacity duration-500 opacity-100">
                                rj-sms-sandbox.sub_pav_us.siaps_consolidado
                            </p>
                            <!-- Indicador visual de animação ativa -->
                            <div id="animationIndicator"
                                class="absolute top-1 right-1 w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"
                                title="Alternando automaticamente"></div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                        <p class="text-xs text-slate-500 uppercase font-semibold mb-1">Fontes Principais</p>
                        <div class="text-slate-800 font-medium text-sm flex flex-col gap-1">
                            <span class="flex items-center gap-1"><i class="ph ph-table"></i> Tabelas SIAPS (Por
                                Componente)</span>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                        <p class="text-xs text-slate-500 uppercase font-semibold mb-1">Granularidade</p>
                        <p class="text-slate-800 font-medium flex items-center gap-2">
                            <i class="ph ph-users text-amber-500"></i> Por Equipe (INE) e Mês
                        </p>
                    </div>
                </div>

                <!-- Sistema de Abas -->
                <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden mb-10">
                    <div class="border-b border-slate-200 flex overflow-x-auto bg-slate-50">
                        <button onclick="openTab('regras')" id="btn-regras"
                            class="tab-btn active px-6 py-4 text-sm font-medium text-slate-500 hover:text-slate-700 focus:outline-none">Regras
                            de Negócio</button>
                        <button onclick="openTab('sql')" id="btn-sql"
                            class="tab-btn px-6 py-4 text-sm font-medium text-slate-500 hover:text-slate-700 focus:outline-none">Script
                            SQL</button>
                        <button onclick="openTab('dicionario')" id="btn-dicionario"
                            class="tab-btn px-6 py-4 text-sm font-medium text-slate-500 hover:text-slate-700 focus:outline-none">Dicionário
                            de Dados</button>
                    </div>

                    <!-- Conteúdo: Regras de Negócio (Separado por ESF, ESB, eMulti) -->
                    <div id="regras" class="tab-content active p-8">
                        <p class="text-slate-600 text-sm mb-6">
                            As queries transformam os dados mensais (colunas largas) em um formato unificado (tabela
                            longa/unpivot), permitindo análise temporal facilitada. Abaixo estão os componentes
                            monitorados por categoria.
                        </p>

                        <!-- Bloco ESF -->
                        <div class="mb-8 border border-blue-100 rounded-lg overflow-hidden">
                            <div class="bg-blue-50 px-6 py-3 border-b border-blue-100 flex items-center gap-2">
                                <i class="ph ph-users-three text-blue-600"></i>
                                <h3 class="font-bold text-blue-800 text-sm uppercase">Estratégia Saúde da Família (ESF)
                                </h3>
                            </div>
                            <div class="p-6 bg-white">
                                <ul class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-700">
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">C1</span>
                                        <span><strong>Mais Acesso:</strong> Indicadores de acesso e vinculação.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">C2</span>
                                        <span><strong>Resolutividade:</strong> Capacidade de resolução na atenção
                                            primária.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">C3</span>
                                        <span><strong>Coordenação do Cuidado:</strong> Integração com outros
                                            níveis.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">C4</span>
                                        <span><strong>Carteira de Serviços:</strong> Oferta de serviços
                                            essenciais.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">C5</span>
                                        <span><strong>Sustentabilidade:</strong> Eficiência no uso de recursos.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">C6</span>
                                        <span><strong>Responsabilidade Sanitária:</strong> Vigilância e
                                            território.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">C7</span>
                                        <span><strong>Prevenção do Câncer:</strong> Rastreamento e prevenção.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">C8</span>
                                        <span><strong>Satisfação do Usuário:</strong> Avaliação da experiência.</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Bloco ESB -->
                        <div class="mb-8 border border-teal-100 rounded-lg overflow-hidden">
                            <div class="bg-teal-50 px-6 py-3 border-b border-teal-100 flex items-center gap-2">
                                <i class="ph ph-smiley text-teal-600"></i>
                                <h3 class="font-bold text-teal-800 text-sm uppercase">Equipes de Saúde Bucal (ESB)</h3>
                            </div>
                            <div class="p-6 bg-white">
                                <ul class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-700">
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">B1</span>
                                        <span><strong>1º Consulta Programada:</strong> Acesso inicial
                                            odontológico.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">B2</span>
                                        <span><strong>Razão Tratamentos Concluídos:</strong> Eficácia do
                                            tratamento.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">B3</span>
                                        <span><strong>Proporção de Exodontias:</strong> Indicador de mutilação
                                            dentária.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">B4</span>
                                        <span><strong>Atendimentos de Urgência:</strong> Resposta a condições
                                            agudas.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">B5</span>
                                        <span><strong>Supervisão TSB:</strong> Acompanhamento técnico.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">B6</span>
                                        <span><strong>Tratamento Restaurador Atraumático:</strong> Procedimentos
                                            conservadores.</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Bloco eMulti -->
                        <div class="border border-purple-100 rounded-lg overflow-hidden">
                            <div class="bg-purple-50 px-6 py-3 border-b border-purple-100 flex items-center gap-2">
                                <i class="ph ph-users-four text-purple-600"></i>
                                <h3 class="font-bold text-purple-800 text-sm uppercase">Equipes Multiprofissionais
                                    (eMulti)</h3>
                            </div>
                            <div class="p-6 bg-white">
                                <ul class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-700">
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">M1</span>
                                        <span><strong>Atendimentos eMulti:</strong> Volume de atendimentos da equipe
                                            multi.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span
                                            class="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 mt-0.5">M2</span>
                                        <span><strong>Ações Interprofissionais:</strong> Atuação conjunta e
                                            matriciamento.</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Conteúdo: SQL -->
                    <div id="sql" class="tab-content p-0">
                        <!-- Barra de Ferramentas do SQL -->
                        <div class="bg-slate-900 border-b border-slate-700 p-4 flex items-center justify-between">
                            <!-- Seletor de Código -->
                            <div class="sql-selector-wrapper">
                                <select id="codeSelector" onchange="switchCodeBlock()" class="sql-select">
                                    <option value="esf">SIAPS - ESF (Saúde da Família)</option>
                                    <option value="esb">SIAPS - ESB (Saúde Bucal)</option>
                                    <option value="emulti">SIAPS - eMulti</option>
                                </select>
                                <i class="ph ph-caret-down select-arrow"></i>
                            </div>

                            <button onclick="copyActiveSql()"
                                class="bg-slate-700 hover:bg-slate-600 text-white text-xs px-3 py-1.5 rounded flex items-center gap-2 transition-colors">
                                <i class="ph ph-copy"></i> Copiar
                            </button>
                        </div>

                        <!-- Bloco 1: ESF -->
                        <div id="block-esf" class="code-block">
                            <pre class="m-0"><code class="language-sql shadow-none rounded-none">
CREATE OR REPLACE TABLE `rj-sms-sandbox.sub_pav_us.siaps_consolidado` AS
WITH
  unpivot_all AS (
  -- ==================================================
    -- Componente 1: Mais Acesso (Tabela: SIAPS_c1_maisacesso_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Mais Acesso' AS Componente, 'num' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c1_maisacesso_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Mais Acesso' AS Componente, 'den' AS Tipo_Indicador, jan_2025_den AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c1_maisacesso_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Mais Acesso' AS Componente, 'percent' AS Tipo_Indicador, jan_2025_percent AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c1_maisacesso_equipes` UNION ALL
    
    -- (Omitidos meses intermediários para brevidade do visualizador, lógica se repete para Fev-Nov)
    
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-12-01' AS Periodo, 'Mais Acesso' AS Componente, 'num' AS Tipo_Indicador, dez_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c1_maisacesso_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-12-01' AS Periodo, 'Mais Acesso' AS Componente, 'den' AS Tipo_Indicador, dez_2025_den AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c1_maisacesso_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-12-01' AS Periodo, 'Mais Acesso' AS Componente, 'percent' AS Tipo_Indicador, dez_2025_percent AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c1_maisacesso_equipes` UNION ALL

  -- ==================================================
    -- Componente 2: Resolutividade (Tabela: SIAPS_c2_resolutividade_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Resolutividade' AS Componente, 'num' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c2_resolutividade_equipes` UNION ALL
    -- ... (Repetição da estrutura para C2)

  -- ==================================================
    -- Componente 3: Coordenação do Cuidado (Tabela: SIAPS_c3_coordenacao_cuidado_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Coordenação do Cuidado' AS Componente, 'num' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c3_coordenacao_cuidado_equipes` UNION ALL
    -- ... (Repetição da estrutura para C3)

  -- ==================================================
    -- Componente 4: Carteira de Serviços (Tabela: SIAPS_c4_carteira_servicos_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Carteira de Serviços' AS Componente, 'num' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c4_carteira_servicos_equipes` UNION ALL
    -- ... (Repetição da estrutura para C4)

  -- ==================================================
    -- Componente 5: Sustentabilidade (Tabela: SIAPS_c5_sustentabilidade_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Sustentabilidade' AS Componente, 'num' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c5_sustentabilidade_equipes` UNION ALL
    -- ... (Repetição da estrutura para C5)

  -- ==================================================
    -- Componente 6: Responsabilidade Sanitária (Tabela: SIAPS_c6_responsabilidade_sanitaria_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Responsabilidade Sanitária' AS Componente, 'num' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c6_responsabilidade_sanitaria_equipes` UNION ALL
    -- ... (Repetição da estrutura para C6)

  -- ==================================================
    -- Componente 7: Prevenção do Câncer (Tabela: SIAPS_c7_prevencao_cancer_equipes)
    -- Obs: Este componente possui subtipos (e, f, g...)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-12-01' AS Periodo, 'Prevenção do câncer' AS Componente, 'e_c7' AS Tipo_Indicador, dez_2025_e AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c7_prevencao_cancer_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-12-01' AS Periodo, 'Prevenção do câncer' AS Componente, 'f_c7' AS Tipo_Indicador, dez_2025_f AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c7_prevencao_cancer_equipes` UNION ALL
    -- ... (Outros subtipos g, h, i)

  -- ==================================================
    -- Componente 8: Satisfação do Usuário (Tabela: SIAPS_c8_satisfacao_usuario_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Satisfação do Usuário' AS Componente, 'num' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_c8_satisfacao_usuario_equipes` UNION ALL
    -- ... (Repetição da estrutura para C8)
  )
SELECT * FROM unpivot_all
WHERE Valor IS NOT NULL;
                            </code></pre>
                        </div>

                        <!-- Bloco 2: ESB -->
                        <div id="block-esb" class="code-block hidden">
                            <pre class="m-0"><code class="language-sql shadow-none rounded-none">
CREATE OR REPLACE TABLE `rj-sms-sandbox.sub_pav_us.siaps_consolidado_esb` AS
WITH
  unpivot_all AS (
  -- ==================================================
    -- Componente 1: 1º consulta programada (Tabela: SIAPS_ESB_b1_1a_cons_prog_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, '1º consulta programada' AS Componente, 'num_B1' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b1_1a_cons_prog_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, '1º consulta programada' AS Componente, 'den_B1' AS Tipo_Indicador, jan_2025_den AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b1_1a_cons_prog_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, '1º consulta programada' AS Componente, 'percent_B1' AS Tipo_Indicador, jan_2025_percent AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b1_1a_cons_prog_equipes` UNION ALL
    
  -- ==================================================
    -- Componente 2: Razão Tratamentos Concluídos (Tabela: SIAPS_ESB_b2_razao_trat_concluidos_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Razão Tratamentos Concluídos' AS Componente, 'num_B2' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b2_razao_trat_concluidos_equipes` UNION ALL
    -- ...

  -- ==================================================
    -- Componente 3: Proporção de exodontias (Tabela: SIAPS_ESB_b3_prop_exodontias_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Proporção de exodontias' AS Componente, 'num_B3' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b3_prop_exodontias_equipes` UNION ALL
    -- ...

  -- ==================================================
    -- Componente 4: Atendimentos de urgência (Tabela: SIAPS_ESB_b4_atend_urgencia_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Atendimentos de urgência' AS Componente, 'num_B4' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b4_atend_urgencia_equipes` UNION ALL
    -- ...

  -- ==================================================
    -- Componente 5: Supervisão TSB (Tabela: SIAPS_ESB_b5_supervisao_tsb_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Supervisão TSB' AS Componente, 'num_B5' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b5_supervisao_tsb_equipes` UNION ALL
    -- ...

  -- ==================================================
    -- Componente 6: Tratamento restaurador (Tabela: SIAPS_ESB_b6_trat_restaurador_atraumatico_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Tratamento restaurador' AS Componente, 'num_B6' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b6_trat_restaurador_atraumatico_equipes` UNION ALL
    -- ...
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-12-01' AS Periodo, 'Tratamento restaurador' AS Componente, 'den_B6' AS Tipo_Indicador, dez_2025_den AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_ESB_b6_trat_restaurador_atraumatico_equipes`
  )
SELECT * FROM unpivot_all WHERE Valor IS NOT NULL;
                            </code></pre>
                        </div>

                        <!-- Bloco 3: eMulti -->
                        <div id="block-emulti" class="code-block hidden">
                            <pre class="m-0"><code class="language-sql shadow-none rounded-none">
CREATE OR REPLACE TABLE `rj-sms-sandbox.sub_pav_us.siaps_consolidado_emulti` AS
WITH
  unpivot_all AS (
  -- ==================================================
    -- Componente 2: Ações Interprofissionais (Tabela: SIAPS_EMULTI_m2_acoes_interprofissionais_emulti_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Ações Interprofissionais' AS Componente, 'num_M2' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_EMULTI_m2_acoes_interprofissionais_emulti_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Ações Interprofissionais' AS Componente, 'den_M2' AS Tipo_Indicador, jan_2025_den AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_EMULTI_m2_acoes_interprofissionais_emulti_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Ações Interprofissionais' AS Componente, 'percent_M2' AS Tipo_Indicador, jan_2025_percent AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_EMULTI_m2_acoes_interprofissionais_emulti_equipes` UNION ALL
    
    -- (Meses intermediários omitidos)

    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-12-01' AS Periodo, 'Ações Interprofissionais' AS Componente, 'num_M2' AS Tipo_Indicador, dez_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_EMULTI_m2_acoes_interprofissionais_emulti_equipes` UNION ALL
    -- ...

  -- ==================================================
    -- Componente 1: Atendimentos eMulti (Tabela: SIAPS_EMULTI_m1_med_atend_emulti_por_pessoa_equipes)
    -- ==================================================
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Atendimentos eMulti' AS Componente, 'num_M1' AS Tipo_Indicador, jan_2025_num AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_EMULTI_m1_med_atend_emulti_por_pessoa_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Atendimentos eMulti' AS Componente, 'den_M1' AS Tipo_Indicador, jan_2025_den AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_EMULTI_m1_med_atend_emulti_por_pessoa_equipes` UNION ALL
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-01-01' AS Periodo, 'Atendimentos eMulti' AS Componente, 'media_M1' AS Tipo_Indicador, jan_2025_media AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_EMULTI_m1_med_atend_emulti_por_pessoa_equipes` UNION ALL
    -- ...
    SELECT ine, ap, cnes, cod_area, unidade, nome_equipe, tipo_equipe, '2025-12-01' AS Periodo, 'Atendimentos eMulti' AS Componente, 'den_M1' AS Tipo_Indicador, dez_2025_den AS Valor FROM `rj-sms-sandbox.sub_pav_us.SIAPS_EMULTI_m1_med_atend_emulti_por_pessoa_equipes`
  )
SELECT * FROM unpivot_all WHERE Valor IS NOT NULL;
                            </code></pre>
                        </div>
                    </div>

                    <!-- Conteúdo: Dicionário (AGORA NA POSIÇÃO CORRETA) -->
                    <div id="dicionario" class="tab-content">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm text-slate-600">
                                <thead class="bg-slate-50 text-slate-500 font-medium border-b border-slate-200">
                                    <tr>
                                        <th class="px-6 py-3 border-r border-slate-200 w-1/4">Coluna</th>
                                        <th class="px-6 py-3 border-r border-slate-200 w-1/6">Tipo</th>
                                        <th class="px-6 py-3">Descrição</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100">
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-pink-600 bg-pink-50/30">ine</td>
                                        <td class="px-6 py-3 text-xs">STRING</td>
                                        <td class="px-6 py-3">Identificador Nacional de Equipe.</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-pink-600 bg-pink-50/30">cnes</td>
                                        <td class="px-6 py-3 text-xs">STRING</td>
                                        <td class="px-6 py-3">Código CNES da unidade de saúde.</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-blue-600 bg-blue-50/30">Periodo</td>
                                        <td class="px-6 py-3 text-xs">DATE</td>
                                        <td class="px-6 py-3">Data de referência do indicador (Primeiro dia do mês).
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-blue-600 bg-blue-50/30">Componente
                                        </td>
                                        <td class="px-6 py-3 text-xs">STRING</td>
                                        <td class="px-6 py-3">Nome do componente avaliado (ex: Mais Acesso, Prevenção do
                                            Câncer).</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-blue-600 bg-blue-50/30">
                                            Tipo_Indicador</td>
                                        <td class="px-6 py-3 text-xs">STRING</td>
                                        <td class="px-6 py-3">Tipo do valor: Numerador ('num'), Denominador ('den') ou
                                            Percentual/Média.</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="px-6 py-3 font-mono text-xs text-emerald-600 bg-emerald-50/30">Valor
                                        </td>
                                        <td class="px-6 py-3 text-xs">FLOAT</td>
                                        <td class="px-6 py-3">Resultado numérico do indicador para aquele mês/equipe.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div> <!-- Fechamento correto da div principal das abas -->

            </div>
        </div>
    </main>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
    <script src="../scripts/global.js"></script>

    <!-- Script Específico para esta página (Troca de Código e Animação) -->
    <script>
        // Mapeamento das tabelas
        const tableNamesMap = {
            'esf': 'rj-sms-sandbox.sub_pav_us.siaps_consolidado',
            'esb': 'rj-sms-sandbox.sub_pav_us.siaps_consolidado_esb',
            'emulti': 'rj-sms-sandbox.sub_pav_us.siaps_consolidado_emulti'
        };

        // Lista para rotação
        const rotationList = [
            'rj-sms-sandbox.sub_pav_us.siaps_consolidado',
            'rj-sms-sandbox.sub_pav_us.siaps_consolidado_esb',
            'rj-sms-sandbox.sub_pav_us.siaps_consolidado_emulti'
        ];

        let currentIndex = 0;
        let rotationInterval = null;
        let isRotating = true; // Flag para saber se a rotação está ativa

        // Função para atualizar o texto com fade
        function updateTableDisplay(text) {
            const display = document.getElementById('tableNameDisplay');
            // Fade Out
            display.style.opacity = '0';
            // Aguarda a transição
            setTimeout(() => {
                display.innerText = text;
                // Fade In
                display.style.opacity = '1';
            }, 500); // 500ms corresponde a duration-500 do CSS
        }

        // Inicia o loop automático
        function startRotation() {
            if (rotationInterval) clearInterval(rotationInterval);
            isRotating = true;
            document.getElementById('animationIndicator').classList.remove('hidden'); // Mostra indicador

            rotationInterval = setInterval(() => {
                currentIndex = (currentIndex + 1) % rotationList.length;
                updateTableDisplay(rotationList[currentIndex]);
            }, 4000); // Troca a cada 4 segundos
        }

        // Para o loop manual
        function stopRotation() {
            if (rotationInterval) {
                clearInterval(rotationInterval);
                rotationInterval = null;
            }
            isRotating = false;
            document.getElementById('animationIndicator').classList.add('hidden'); // Esconde indicador
        }

        // Iniciar rotação ao carregar
        window.addEventListener('load', startRotation);

        // Função para copiar o código SQL visível
        function copyActiveSql() {
            const selector = document.getElementById('codeSelector');
            const activeId = 'block-' + selector.value;
            const codeBlock = document.querySelector('#' + activeId + ' code');

            if (codeBlock) {
                const text = codeBlock.innerText;
                navigator.clipboard.writeText(text).then(() => {
                    const btn = document.querySelector('button[onclick="copyActiveSql()"]');
                    const originalHtml = btn.innerHTML;
                    btn.innerHTML = '<i class="ph ph-check"></i> Copiado!';
                    setTimeout(() => {
                        btn.innerHTML = originalHtml;
                    }, 2000);
                });
            }
        }

        // Função chamada ao mudar o select: PARA a rotação e mostra a tabela correta
        function switchCodeBlock() {
            const selector = document.getElementById('codeSelector');
            const value = selector.value;

            // 1. Para a rotação automática se o usuário interagir
            stopRotation();

            // 2. Alternar Blocos de Código
            document.querySelectorAll('.code-block').forEach(el => {
                el.classList.add('hidden');
            });
            const activeBlock = document.getElementById('block-' + value);
            if (activeBlock) {
                activeBlock.classList.remove('hidden');
            }

            // 3. Atualizar Nome da Tabela imediatamente para corresponder ao código
            updateTableDisplay(tableNamesMap[value]);
        }
    </script>
</body>

</html>